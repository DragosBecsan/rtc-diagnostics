{"version":3,"file":"AudioOutputTest.js","sourceRoot":"","sources":["../../../tests/unit/AudioOutputTest.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable only-arrow-functions\n\nimport * as assert from 'assert';\nimport * as sinon from 'sinon';\nimport {\n  AudioOutputTest,\n  testAudioOutputDevice,\n} from '../../lib/AudioOutputTest';\nimport { ErrorName } from '../../lib/constants';\nimport { DiagnosticError } from '../../lib/errors/DiagnosticError';\nimport { AudioElement } from '../../lib/types';\nimport { mockAudioContextFactory } from '../mocks/MockAudioContext';\nimport { mockAudioElementFactory } from '../mocks/MockAudioElement';\nimport { mockEnumerateDevicesFactory } from '../mocks/mockEnumerateDevices';\n\nconst defaultDuration = 100;\nconst defaultVolumeEventIntervalMs = 1;\n\ndescribe('testAudioOutputDevice', function() {\n  const audioElementFactory: (new () => AudioElement) = mockAudioElementFactory({\n    supportSetSinkId: true,\n  }) as any;\n\n  const volumeValues = 100;\n  describe(`with volume values of ${volumeValues}`, function() {\n    let report: AudioOutputTest.Report;\n\n    before(async function() {\n      report = await new Promise(resolve => {\n        testAudioOutputDevice({\n          audioContextFactory: mockAudioContextFactory({\n            analyserNodeOptions: { volumeValues },\n          }) as any,\n          audioElementFactory,\n          duration: defaultDuration,\n          enumerateDevices: mockEnumerateDevicesFactory({\n            devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n          }),\n          volumeEventIntervalMs: defaultVolumeEventIntervalMs,\n        }).on(AudioOutputTest.Events.End, (r) => resolve(r));\n      });\n    });\n\n    it('timestamps should be set', function() {\n      assert(report.testTiming);\n      assert(report.testTiming.duration);\n      assert(report.testTiming.end);\n      assert(report.testTiming.start);\n    });\n\n    it(`all volume values should be ${volumeValues}`, function() {\n      assert(report.values.every(v => v === volumeValues));\n    });\n  });\n\n  describe('with volume values of 0', function() {\n    let report: AudioOutputTest.Report;\n\n    before(async function() {\n      const audioContextFactory: typeof AudioContext = mockAudioContextFactory({\n        analyserNodeOptions: { volumeValues: 0 },\n      }) as any;\n\n      report = await new Promise(resolve => {\n        testAudioOutputDevice({\n          audioContextFactory,\n          audioElementFactory,\n          duration: defaultDuration,\n          enumerateDevices: mockEnumerateDevicesFactory({\n            devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n          }),\n          volumeEventIntervalMs: defaultVolumeEventIntervalMs,\n        }).on(AudioOutputTest.Events.End, (r) => resolve(r));\n      });\n    });\n\n    it('timestamps should be set', function() {\n      assert(report.testTiming);\n      assert(report.testTiming.duration);\n      assert(report.testTiming.end);\n      assert(report.testTiming.start);\n    });\n\n    it('all volume values should be 0', function() {\n      assert(report.values.every(v => v === 0));\n    });\n  });\n\n  it('should report if stopped normally', async function() {\n    const report: AudioOutputTest.Report = await new Promise(resolve => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory({\n          analyserNodeOptions: { volumeValues },\n        }) as any,\n        audioElementFactory,\n        enumerateDevices: mockEnumerateDevicesFactory({\n          devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n        }),\n        volumeEventIntervalMs: defaultVolumeEventIntervalMs,\n      });\n      test.on(AudioOutputTest.Events.End, resolve);\n      setTimeout(() => {\n        test.stop();\n      }, defaultDuration);\n    });\n    assert(report);\n  });\n\n  it('should report the default device if not passing in a deviceId', async function() {\n    const report: AudioOutputTest.Report = await new Promise(resolve => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory() as any,\n        audioElementFactory,\n        enumerateDevices: mockEnumerateDevicesFactory({\n          devices: [{\n            deviceId: 'foo',\n            kind: 'audiooutput',\n          }, {\n            deviceId: 'bar',\n            kind: 'audiooutput',\n          }] as any,\n        }),\n      });\n      test.on(AudioOutputTest.Events.End, resolve);\n      setTimeout(() => {\n        test.stop();\n      }, defaultDuration);\n    });\n    assert(report);\n    assert.equal(report.deviceId, 'foo');\n  });\n\n  it('should report the passed device if passing in a deviceId', async function() {\n    const report: AudioOutputTest.Report = await new Promise(resolve => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory() as any,\n        audioElementFactory,\n        deviceId: 'bar',\n        enumerateDevices: mockEnumerateDevicesFactory({\n          devices: [{\n            deviceId: 'foo',\n            kind: 'audiooutput',\n          }, {\n            deviceId: 'bar',\n            kind: 'audiooutput',\n          }] as any,\n        }),\n      });\n      test.on(AudioOutputTest.Events.End, resolve);\n      setTimeout(() => {\n        test.stop();\n      }, defaultDuration);\n    });\n    assert(report);\n    assert.equal(report.deviceId, 'bar');\n  });\n\n  describe('should immediately end and report an error', function() {\n    // not providing the mock object here results in the test resorting to the\n    // global\n    // because these are unit tests, and node does not have these globals,\n    // they are null and are essentially \"not supported\"\n\n    it('when AudioContext is not supported', async function() {\n      const report: AudioOutputTest.Report = await new Promise(resolve => {\n        const test = testAudioOutputDevice({\n          audioElementFactory,\n          enumerateDevices: mockEnumerateDevicesFactory({\n            devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n          }),\n        });\n        test.on(AudioOutputTest.Events.Error, () => {\n          // do nothing, prevent rejection\n        });\n        test.on(AudioOutputTest.Events.End, (r) => resolve(r));\n      });\n      assert(report);\n      assert.equal(report.errors.length, 1);\n      const [error] = report.errors;\n      assert(error instanceof DiagnosticError);\n      assert.equal(error.name, ErrorName.UnsupportedError);\n    });\n    it('when Audio is not supported', async function() {\n      const report: AudioOutputTest.Report = await new Promise(resolve => {\n        const test = testAudioOutputDevice({\n          audioContextFactory: mockAudioContextFactory() as any,\n          enumerateDevices: mockEnumerateDevicesFactory({\n            devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n          }),\n        });\n        test.on(AudioOutputTest.Events.Error, () => {\n          // do nothing, prevent rejection\n        });\n        test.on(AudioOutputTest.Events.End, (r) => resolve(r));\n      });\n      assert(report);\n      assert.equal(report.errors.length, 1);\n      const [error] = report.errors;\n      assert(error instanceof DiagnosticError);\n      assert.equal(error.name, ErrorName.UnsupportedError);\n    });\n    it('when neither AudioContext or Audio is supported', async function() {\n      const report: AudioOutputTest.Report = await new Promise(resolve => {\n        const test = testAudioOutputDevice({\n          enumerateDevices: mockEnumerateDevicesFactory({\n            devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n          }),\n        });\n        test.on(AudioOutputTest.Events.Error, () => {\n          // do nothing, prevent rejection\n        });\n        test.on(AudioOutputTest.Events.End, (r) => resolve(r));\n      });\n      assert(report);\n      assert.equal(report.errors.length, 1);\n      const [error] = report.errors;\n      assert(error instanceof DiagnosticError);\n      assert.equal(error.name, ErrorName.UnsupportedError);\n    });\n  });\n\n  it('should warn if stopped twice', function() {\n    const stub = sinon.stub(console, 'warn');\n    const test = testAudioOutputDevice({\n      audioContextFactory: mockAudioContextFactory({\n        analyserNodeOptions: { volumeValues: 100 },\n      }) as any,\n      audioElementFactory,\n      debug: true,\n      enumerateDevices: mockEnumerateDevicesFactory({\n        devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n      }),\n    });\n    test.stop();\n    test.stop();\n    assert(stub.callCount);\n    stub.restore();\n  });\n\n  ([\n    [new DiagnosticError(), 'DiagnosticError'],\n    [new (global as any).DOMError(), 'DOMError'],\n    [new (global as any).DOMException(), 'DOMException'],\n    [new Error(), 'Error'],\n    [{}, 'an unknown error'],\n  ] as const).forEach(([error, name]) => {\n    describe(`should handle ${name}`, function() {\n      let report: AudioOutputTest.Report | undefined;\n\n      beforeEach(async function() {\n        report = await new Promise(resolve => {\n          const test = testAudioOutputDevice({\n            audioContextFactory: mockAudioContextFactory({\n              throw: { construction: error },\n            }) as any,\n            audioElementFactory,\n            duration: defaultDuration,\n            enumerateDevices: mockEnumerateDevicesFactory({\n              devices: [{ deviceId: 'default', kind: 'audiooutput' } as any],\n            }),\n            volumeEventIntervalMs: defaultVolumeEventIntervalMs,\n          });\n          test.on(AudioOutputTest.Events.Error, () => { /* no-op */ });\n          test.on(AudioOutputTest.Events.End, resolve);\n        });\n      });\n\n      it('should report an error', function() {\n        assert(report);\n        assert.equal(report?.errors.length, 1);\n      });\n\n      afterEach(function() {\n        report = undefined;\n      });\n    });\n  });\n\n  it('should allow `deviceId` if `setSinkId` is supported', async function() {\n    const report = await new Promise(resolve => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory({\n          analyserNodeOptions: { volumeValues: 100 },\n        }) as any,\n        audioElementFactory,\n        deviceId: 'foobar',\n        duration: defaultDuration,\n        enumerateDevices: mockEnumerateDevicesFactory({\n          devices: [{ deviceId: 'foobar', kind: 'audiooutput' } as any],\n        }),\n        volumeEventIntervalMs: defaultVolumeEventIntervalMs,\n      });\n      test.on(AudioOutputTest.Events.End, (r) => resolve(r));\n      test.stop();\n    });\n    assert(report);\n  });\n\n  it('should not allow `deviceId` if `setSinkId` is unsupported', async function() {\n    const test = testAudioOutputDevice({\n      audioContextFactory: mockAudioContextFactory() as any,\n      audioElementFactory: mockAudioElementFactory({ supportSetSinkId: false }) as any,\n      deviceId: 'foobar',\n      enumerateDevices: mockEnumerateDevicesFactory({\n        devices: [{ deviceId: 'foobar', kind: 'audiooutput' } as any],\n      }),\n    });\n\n    const results = await Promise.all([\n      new Promise(resolve => test.on(AudioOutputTest.Events.Error, resolve)),\n      new Promise(resolve => test.on(AudioOutputTest.Events.End, resolve)),\n    ]);\n\n    const error = results[0] as DiagnosticError;\n    const report = results[1] as AudioOutputTest.Report;\n\n    assert(error);\n    assert(report);\n  });\n\n  it('should throw during setup when `enumerateDevices` is not supported', async function() {\n    await assert.rejects(() => new Promise((_, reject) => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory() as any,\n        audioElementFactory,\n        deviceId: 'foobar',\n      });\n      test.on(AudioOutputTest.Events.Error, err => reject(err));\n    }));\n  });\n\n  it('should throw during setup when there are no detected output devices', async function() {\n    await assert.rejects(() => new Promise((_, reject) => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory() as any,\n        audioElementFactory: mockAudioElementFactory() as any,\n        deviceId: 'foobar',\n        enumerateDevices: mockEnumerateDevicesFactory({\n          devices: [],\n        }),\n      });\n      test.on(AudioOutputTest.Events.Error, err => reject(err));\n    }));\n  });\n\n  it('should throw `InvalidOptions` error if passed invalid options', async function() {\n    const report: AudioOutputTest.Report = await new Promise(resolve => {\n      const test = testAudioOutputDevice({\n        audioContextFactory: mockAudioContextFactory() as any,\n        audioElementFactory: mockAudioElementFactory() as any,\n        deviceId: {} as any, // is invalid because not type `string`\n        enumerateDevices: mockEnumerateDevicesFactory({\n          devices: [{\n            deviceId: 'foobar',\n            groupId: 'biffbazz',\n            kind: 'audioinput',\n            label: 'test-device',\n            toJSON: () => 'some-json',\n          }],\n        }) as any,\n      });\n      test.on(AudioOutputTest.Events.Error, () => { /* no-op */ });\n      test.on(AudioOutputTest.Events.End, resolve);\n    });\n    assert.equal(report.errors.length, 1);\n    assert(report.errors[0] instanceof DiagnosticError);\n    assert.equal(report.errors[0].name, ErrorName.InvalidOptionsError);\n  });\n});\n"]}